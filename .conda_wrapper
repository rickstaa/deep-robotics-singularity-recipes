
# <<< conda_wrapper function <<<
# This wrapper was added to solve for the conflicts caused by sourcing a ROS setup.bash file inside a
# conda enviroment.

# Get conda install pythonpath
CONDA_PATH=$(echo $CONDA_EXE |sed -e 's/\/bin\/conda//')
export CONDA_PATH

# Initialize conda wrapper function
function _conda_wrapper {
    if [ $1 == "activate" ] # Warp conda deactivate command
    then

        # Get conda site-pack folder
        _conda_site_packages=$(find "$CONDA_PATH"/envs/"$2" -iname site-packages)

        # Safe old conda pythonpath
        export _OLD_PYTHONPATH="$PYTHONPATH"

        # Prepent conda site-packages folder to the PYTHONPATH
        export PYTHONPATH="$_conda_site_packages:$PYTHONPATH"

        # Run conda activate command
        conda $@
    elif [ $1 == "deactivate" ] # Warp conda deactivate command
    then

        # Remove conda site-packages folder from the PYTHONPATH
        PYTHONPATH=$_OLD_PYTHONPATH
        unset _OLD_PYTHONPATH

        # Run conda deactivate command
        conda $@
    else # Warp other conda commands
        echo "Other command"
        conda $@
    fi
}
alias conda='_conda_wrapper $@'
# <<< Conda wrapper function <<<

